# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#  Miyabi Multi-Agent Orchestration Visualization
#  tmux Configuration
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# ══════════════════════════════════════════════════════════════════════
# General Settings
# ══════════════════════════════════════════════════════════════════════

# Set default terminal to support 256 colors
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Enable mouse support
set -g mouse on

# Set escape time to 0 for faster command sequences
set -sg escape-time 0

# Increase scrollback buffer
set -g history-limit 50000

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Enable focus events
set -g focus-events on

# ══════════════════════════════════════════════════════════════════════
# Status Bar Configuration
# ══════════════════════════════════════════════════════════════════════

# Status bar position (top)
set -g status-position top

# Status bar update interval (1 second for real-time feel)
set -g status-interval 1

# Status bar length
set -g status-left-length 100
set -g status-right-length 100

# Status bar colors
set -g status-style "bg=colour235,fg=colour255"

# Status bar left: Session name + World state
set -g status-left "#[bg=colour25,fg=colour255,bold] MIYABI ORCHESTRATOR #[bg=colour235] #[fg=colour39]World: #[fg=colour255,bold]W#{?#{==:#{pane_current_command},bash},0,#{window_index}} → W∞ "

# Status bar right: Convergence + Active agents + Time
set -g status-right "#[fg=colour39]Conv: #[fg=colour255,bold]67%% #[fg=colour239]│ #[fg=colour39]Active: #[fg=colour255,bold]3/6 #[fg=colour239]│ #[fg=colour39]%H:%M:%S"

# Window status format
setw -g window-status-format " #I:#W "
setw -g window-status-current-format "#[bg=colour39,fg=colour235,bold] #I:#W "

# ══════════════════════════════════════════════════════════════════════
# Pane Border Configuration
# ══════════════════════════════════════════════════════════════════════

# Pane border colors
set -g pane-border-style "fg=colour239"
set -g pane-active-border-style "fg=colour39"

# Pane border format
set -g pane-border-format " #{pane_index}: #{pane_current_command} "
set -g pane-border-status top

# ══════════════════════════════════════════════════════════════════════
# Key Bindings
# ══════════════════════════════════════════════════════════════════════

# Prefix key (keep default Ctrl-b)
unbind C-b
set -g prefix C-b
bind C-b send-prefix

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Agent Navigation Shortcuts
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Focus on specific agent panes
bind 1 select-pane -t 1  # θ₁ Understand
bind 2 select-pane -t 2  # θ₂ Generate
bind 3 select-pane -t 3  # θ₃ Allocate
bind 4 select-pane -t 4  # θ₄ Execute
bind 5 select-pane -t 5  # θ₅ Integrate
bind 6 select-pane -t 6  # θ₆ Learn
bind o select-pane -t 7  # Orchestrator
bind l select-pane -t 8  # Event log

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Pane Navigation
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Vi-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Window Navigation
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Quick window switching
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# Next/previous window
bind -r n next-window
bind -r p previous-window

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Pane Splitting
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Split panes with intuitive keys
bind | split-window -h
bind - split-window -v

# Remove default bindings
unbind '"'
unbind %

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Copy Mode (Vi style)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Vi mode
setw -g mode-keys vi

# Copy mode bindings
bind Escape copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# System Control Bindings
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Pause/resume updates
bind P run-shell "pkill -STOP -f 'agent_simulator.sh'"
bind R run-shell "pkill -CONT -f 'agent_simulator.sh'"

# Kill all agent processes and quit
bind q confirm-before -p "Kill all agents and quit? (y/n)" "run-shell 'pkill -f agent_simulator.sh; tmux kill-session'"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Plugins (Optional)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# List of plugins
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# Initialize TMUX plugin manager (keep this line at the very bottom)
# run '~/.tmux/plugins/tpm/tpm'

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# END OF CONFIGURATION
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
