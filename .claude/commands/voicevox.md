---
description: "Enable VoiceVox text-to-speech mode for responses"
---

# VoiceVox 音声読み上げモード

VoiceVoxを使用してClaude Codeの応答を音声で読み上げるモードを有効にします。

## 🎤 概要

このコマンドは、以下の機能を提供します：

1. **音声読み上げモードの有効化**: Claude の応答を自動的に音声で読み上げ
2. **複数の話者選択**: ずんだもん、四国めたん、春日部つむぎなど
3. **重要な情報の強調**: エラーやワーニングを特別な声で読み上げ

## 📋 前提条件

### VoiceVox Engine のインストールと起動

**macOS / Linux / Windows:**
1. VoiceVox Engine をダウンロード: https://voicevox.hiroshiba.jp/
2. インストール後、VoiceVox Engine を起動
3. デフォルトで `http://localhost:50021` で API が利用可能になります

**動作確認:**
```bash
curl http://localhost:50021/version
```

## 🚀 使い方

### 基本的な使い方

```bash
# デフォルトの話者（ずんだもん）で音声読み上げモードを有効化
/voicevox

# 特定の話者を指定
/voicevox metan     # 四国めたん
/voicevox tsumugi   # 春日部つむぎ
/voicevox zundamon  # ずんだもん
```

### コマンド実行後の動作

音声読み上げモードが有効になると、以下のように動作します：

1. **通常の応答**: 全ての応答を指定した話者の声で読み上げ
2. **コード説明**: コードの内容を日本語で説明して読み上げ
3. **エラー通知**: エラーが発生した場合は音声で通知
4. **完了通知**: タスク完了時に音声で通知

## 🎯 実装すべき動作

### 音声読み上げの対象

以下の情報を音声で読み上げます：

#### 1. 通常の応答
```
ユーザー: "ファイルを読み込んで"
Claude (音声): "はい、ファイルを読み込みます。ファイルの内容を確認しました。"
```

#### 2. ツール実行の通知
```
Claude (音声): "Bashツールを使用してコマンドを実行します。"
[コマンド実行]
Claude (音声): "コマンドが正常に完了しました。"
```

#### 3. エラー通知
```
Claude (音声): "エラーが発生しました。ファイルが見つかりません。"
```

#### 4. 重要な情報の強調
```
Claude (音声): "注意: このコマンドは本番環境に影響を与える可能性があります。"
```

### 読み上げのタイミング

- **即座に読み上げ**: 短い応答（200文字以内）は即座に読み上げ
- **段落ごとに読み上げ**: 長い応答は段落ごとに分けて読み上げ
- **重要情報を優先**: エラーやワーニングは最優先で読み上げ

### 読み上げのスキップ対象

以下のコンテンツは読み上げをスキップ：

- コードブロック（コード自体は読まない、説明のみ読む）
- 長いログ出力（要約のみ読む）
- マークダウンの記号（`#`, `*`, `-` など）
- URL（「URLが表示されています」と読む）

## 🔧 音声読み上げの実装手順

### ステップ1: VoiceVox Engine の確認

```bash
# VoiceVox Engine が起動しているか確認
python3 scripts/voicevox_speak.py "テストです"
```

### ステップ2: 音声読み上げモードの有効化

音声読み上げモードが有効になると、以下のフラグを内部的に設定：

```
VOICEVOX_MODE=true
VOICEVOX_SPEAKER=<選択した話者>
```

### ステップ3: 応答の音声化

各応答を生成した後、以下の処理を実行：

1. **テキストのクリーニング**: マークダウン記号、コードブロックを除去
2. **テキストの分割**: 長い文章を適切な長さに分割（100-200文字）
3. **音声合成**: VoiceVox API を使用して音声を生成
4. **再生**: 生成した音声を自動再生

### ステップ4: 音声読み上げの例

```python
# Example: 応答を音声で読み上げる
response_text = "ファイルの読み込みが完了しました。全部で150行あります。"

# クリーニング
cleaned_text = clean_markdown(response_text)

# 音声合成と再生
subprocess.run([
    "python3",
    "scripts/voicevox_speak.py",
    cleaned_text,
    speaker
])
```

## 📝 利用シーン

### シーン1: コーディング中の通知

```
ユーザー: "テストを実行して"
Claude: "テストを実行します。"
[音声] 🎤 "テストを実行します"
[テスト実行中...]
[音声] 🎤 "テストが完了しました。すべてのテストに合格しました。"
```

### シーン2: エラーのハンズフリー通知

```
ユーザー: "ビルドして"
Claude: "ビルドを開始します。"
[音声] 🎤 "ビルドを開始します"
[ビルド実行中...]
[音声] 🎤 "エラーが発生しました。構文エラーが3件見つかりました。"
```

### シーン3: 長時間タスクの進捗通知

```
ユーザー: "すべてのテストを実行して"
Claude: "全テストを実行します。"
[音声] 🎤 "全てのテストを実行します。これには数分かかる場合があります。"
[テスト実行中...]
[音声] 🎤 "テストの50%が完了しました"
[さらにテスト実行中...]
[音声] 🎤 "全てのテストが完了しました。152件のテストに合格しました。"
```

## 🎨 話者の特性

### 利用可能な話者

| 話者 | ID | 特徴 | 推奨用途 |
|------|----|----|---------|
| **ずんだもん** (zundamon) | 3 | 明るく元気な声 | 通常の通知、成功メッセージ |
| **四国めたん** (metan) | 2 | 落ち着いた声 | エラー通知、警告 |
| **春日部つむぎ** (tsumugi) | 8 | 優しい声 | 長い説明、ドキュメント |
| **雨晴はう** (ritsu) | 9 | かわいい声 | 完了通知、励まし |

### 話者の使い分け

```bash
# 通常の作業: ずんだもん（デフォルト）
/voicevox

# 重要な説明: 春日部つむぎ
/voicevox tsumugi

# エラー通知: 四国めたん
/voicevox metan
```

## 🔄 音声読み上げモードの終了

音声読み上げモードを終了するには：

```bash
# モードを無効化
/voicevox off

# または
/voicevox disable
```

## ⚙️ 高度な設定

### カスタマイズ可能な設定

```bash
# 環境変数で設定をカスタマイズ
export VOICEVOX_URL="http://localhost:50021"  # VoiceVox API URL
export VOICEVOX_SPEED="1.0"                   # 読み上げ速度（0.5-2.0）
export VOICEVOX_PITCH="0"                     # ピッチ調整（-20～20）
export VOICEVOX_VOLUME="1.0"                  # 音量（0.0-2.0）
```

### テキストのフィルタリング

以下のパターンを検出して適切に処理：

1. **コードブロック**: 「コードが表示されています」
2. **URL**: 「URLが表示されています」
3. **長いパス**: ファイル名のみを読む
4. **エラーメッセージ**: 重要な部分のみ読む

## 🐛 トラブルシューティング

### VoiceVox Engine が起動していない

```
✗ VoiceVox Engine not running
  Please start VoiceVox Engine first:
  https://voicevox.hiroshiba.jp/
```

**解決方法**: VoiceVox Engine を起動してください。

### 音声が再生されない

```
⚠ No audio player found. Audio saved to: /tmp/xxxxx.wav
```

**解決方法**:
- macOS: 通常は `afplay` が利用可能（標準搭載）
- Linux: `sox` または `alsa-utils` をインストール
- すべて: `ffmpeg` をインストール

### 読み上げが遅い

VoiceVox API の応答速度に依存します。音声合成には通常1-3秒かかります。

## 📚 参考リンク

- [VoiceVox 公式サイト](https://voicevox.hiroshiba.jp/)
- [VoiceVox API ドキュメント](https://voicevox.github.io/voicevox_engine/api/)
- [VoiceVox Engine GitHub](https://github.com/VOICEVOX/voicevox_engine)

## 💡 実装のヒント

このコマンドを実装する際は、以下の点に注意してください：

1. **非同期処理**: 音声合成は非同期で実行し、UI をブロックしない
2. **キャッシュ**: 同じテキストの音声はキャッシュして再利用
3. **優先度**: エラーメッセージは優先的に読み上げ
4. **ユーザー体験**: 長い応答は要約してから読み上げ

---

**Note**: このコマンドは実験的な機能です。フィードバックをお待ちしています！
